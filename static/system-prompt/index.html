<!DOCTYPE html>
<html lang="zh-CN">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Prompt Viewer</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    </head>

    <body class="bg-gray-100 min-h-screen p-8">
        <div class="max-w-6xl mx-auto">
            <header class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-100">Prompt Viewer</h1>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button id="language-toggle" class="px-4 py-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl">
                            <i class="fas fa-globe"></i>
                        </button>
                        <nav id="language-dropdown" class="absolute right-0 mt-2 w-32 bg-white dark:bg-gray-700 rounded-md shadow-lg hidden z-10">
                            <a href="#" id="lang-en" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-600">English</a>
                            <a href="#" id="lang-zh" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-gray-600">中文</a>
                        </nav>
                    </div>
                </div>
            </header>

            <main>
                <nav class="mb-6">
                    <div class="flex border-b border-gray-200 dark:border-gray-700">
                        <button id="web-reflect-tab" class="px-4 py-2 font-medium text-blue-600 border-b-2 border-blue-600 dark:text-blue-400 dark:border-blue-400">Web://Reflect</button>
                        <button id="bio-tab" class="px-4 py-2 font-medium text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200" onclick="viewer.loadModule('biosync')">Bio://Sync</button>
                        <button id="meta-tab" class="px-4 py-2 font-medium text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200" onclick="viewer.loadModule('metalayer')">MetaLayer</button>
                    </div>
                </nav>

                <section class="relative bg-white dark:bg-gray-800 rounded-lg shadow overflow-hidden">
                    <div id="zh-content" class="p-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-500 dark:text-gray-400">realityengine-reflect-7.2.md</span>
                            <button onclick="viewer.copyContent('zh')"
                                class="px-3 py-1 bg-blue-100 text-blue-600 text-sm rounded hover:bg-blue-200 dark:bg-blue-800 dark:text-blue-200 dark:hover:bg-blue-700">
                                复制
                            </button>
                        </div>
                        <pre
                            class="bg-gray-50 dark:bg-gray-900 p-4 rounded overflow-auto max-h-96"><code id="zh-code" class="language-markdown"></code></pre>
                    </div>

                    <div id="en-content" class="p-4 hidden">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-500 dark:text-gray-400">realityengine-reflect-7.2.en.md</span>
                            <button onclick="viewer.copyContent('en')"
                                class="px-3 py-1 bg-blue-100 text-blue-600 text-sm rounded hover:bg-blue-200 dark:bg-blue-800 dark:text-blue-200 dark:hover:bg-blue-700">
                                复制
                            </button>
                        </div>
                        <pre
                            class="bg-gray-50 dark:bg-gray-900 p-4 rounded overflow-auto max-h-96"><code id="en-code" class="language-markdown"></code></pre>
                    </div>

                    <div id="biosync-zh-content" class="p-4 hidden">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-500 dark:text-gray-400">remodule-biosync-0.2.0-raw.md</span>
                            <button onclick="viewer.copyContent('biosync-zh')"
                                class="px-3 py-1 bg-blue-100 text-blue-600 text-sm rounded hover:bg-blue-200 dark:bg-blue-800 dark:text-blue-200 dark:hover:bg-blue-700">
                                复制
                            </button>
                        </div>
                        <pre
                            class="bg-gray-50 dark:bg-gray-900 p-4 rounded overflow-auto max-h-96"><code id="biosync-zh-code" class="language-markdown"></code></pre>
                    </div>

                    <div id="metalayer-zh-content" class="p-4 hidden">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-500 dark:text-gray-400">remodule-metalayer-1.0-raw.md</span>
                            <button onclick="viewer.copyContent('metalayer-zh')"
                                class="px-3 py-1 bg-blue-100 text-blue-600 text-sm rounded hover:bg-blue-200 dark:bg-blue-800 dark:text-blue-200 dark:hover:bg-blue-700">
                                复制
                            </button>
                        </div>
                        <pre
                            class="bg-gray-50 dark:bg-gray-900 p-4 rounded overflow-auto max-h-96"><code id="metalayer-zh-code" class="language-markdown"></code></pre>
                    </div>
                </section>
            </main>
        </div>

        <script>
            class PromptViewer {
                constructor() {
                    this.$ = id => document.getElementById(id);
                    this.contentElements = ['zh-content', 'en-content', 'biosync-zh-content', 'metalayer-zh-content'];
                    this.tabElements = ['web-reflect-tab', 'bio-tab', 'meta-tab'];
                    this.modulePaths = {
                        'biosync': '../system-prompt/remodule/remodule-biosync-0.2.0-raw.md',
                        'metalayer': '../system-prompt/remodule/remodule-metalayer-1.0-raw.md'
                    };
                    this.init();
                }

                init() {
                    this.loadInitialContent();
                    this.setupEventListeners();
                    this.applySavedSettings();
                }

                async loadInitialContent() {
                    try {
                        const [zhResp, enResp, biosyncResp, metalayerResp] = await Promise.all([
                            fetch('../system-prompt/realityengine-reflect-7.2.md'),
                            fetch('../system-prompt/realityengine-reflect-7.2.en.md'),
                            fetch(this.modulePaths['biosync']),
                            fetch(this.modulePaths['metalayer'])
                        ]);

                        const [zhContent, enContent, biosyncContent, metalayerContent] = await Promise.all([
                            zhResp.text(),
                            enResp.text(),
                            biosyncResp.text(),
                            metalayerResp.text()
                        ]);

                        this.$('zh-code').textContent = zhContent;
                        this.$('en-code').textContent = enContent;
                        this.$('biosync-zh-code').textContent = biosyncContent;
                        this.$('metalayer-zh-code').textContent = metalayerContent;

                        hljs.highlightAll();
                    } catch (error) {
                        console.error('加载内容失败:', error);
                    }
                }

                setupEventListeners() {
                    this.$('language-toggle').addEventListener('click', () => {
                        this.$('language-dropdown').classList.toggle('hidden');
                    });

                    this.$('lang-en').addEventListener('click', (e) => {
                        e.preventDefault();
                        localStorage.setItem('preferredLang', 'en');
                        this.setLanguage('en');
                        this.$('language-dropdown').classList.add('hidden');
                    });

                    this.$('lang-zh').addEventListener('click', (e) => {
                        e.preventDefault();
                        localStorage.setItem('preferredLang', 'zh');
                        this.setLanguage('zh');
                        this.$('language-dropdown').classList.add('hidden');
                    });

                    this.$('web-reflect-tab').addEventListener('click', () => {
                        const savedLang = localStorage.getItem('preferredLang');
                        this.setLanguage(savedLang || ((navigator.language || navigator.userLanguage).startsWith('zh') ? 'zh' : 'en'));
                    });
                }

                setLanguage(lang) {
                    this.hideAllContent();
                    this.deactivateAllTabs();

                    this.$(lang === 'zh' ? 'zh-content' : 'en-content').classList.remove('hidden');
                    this.activateTab('web-reflect-tab');
                    localStorage.setItem('activeTab', 'web-reflect');

                    if (lang === 'en') {
                        this.$('biosync-zh-code').textContent = '';
                        this.$('metalayer-zh-code').textContent = '';
                    }
                }

                async loadModule(moduleName) {
                    const filePath = this.modulePaths[moduleName];
                    const contentId = `${moduleName}-zh-content`;
                    const codeId = `${moduleName}-zh-code`;
                    const tabId = `${moduleName}-tab`;

                    if (!filePath) return;

                    try {
                        const resp = await fetch(filePath);
                        const content = await resp.text();

                        this.hideAllContent();
                        this.deactivateAllTabs();

                        this.$(contentId).classList.remove('hidden');
                        this.$(codeId).textContent = content;
                        hljs.highlightAll();

                        this.activateTab(tabId);
                        localStorage.setItem('activeTab', moduleName);
                    } catch (error) {
                        console.error(`加载 ${moduleName} 模块失败:`, error);
                    }
                }

                copyContent(lang) {
                    const contentMap = {
                        'zh': this.$('zh-code'),
                        'en': this.$('en-code'),
                        'biosync-zh': this.$('biosync-zh-code'),
                        'metalayer-zh': this.$('metalayer-zh-code')
                    };
                    const content = contentMap[lang]?.textContent;

                    if (content) {
                        navigator.clipboard.writeText(content).then(() => {
                            const btnMap = {
                                'zh': this.$('zh-content').querySelector('button'),
                                'en': this.$('en-content').querySelector('button'),
                                'biosync-zh': this.$('biosync-zh-content').querySelector('button'),
                                'metalayer-zh': this.$('metalayer-zh-content').querySelector('button')
                            };
                            const btn = btnMap[lang];

                            if (btn) {
                                const originalText = btn.textContent;
                                btn.textContent = '已复制!';
                                setTimeout(() => {
                                    btn.textContent = originalText;
                                }, 2000);
                            }
                        });
                    }
                }

                hideAllContent() {
                    this.contentElements.forEach(id => {
                        const el = this.$(id);
                        if (el) el.classList.add('hidden');
                    });
                }

                deactivateAllTabs() {
                    this.tabElements.forEach(id => {
                        const el = this.$(id);
                        if (el) {
                            el.classList.remove('text-blue-600', 'border-blue-600', 'dark:text-blue-400', 'dark:border-blue-400');
                            el.classList.add('text-gray-500', 'dark:text-gray-400');
                        }
                    });
                }

                activateTab(tabId) {
                    const el = this.$(tabId);
                    if (el) {
                        el.classList.add('text-blue-600', 'border-b-2', 'border-blue-600', 'dark:text-blue-400', 'dark:border-blue-400');
                        el.classList.remove('text-gray-500', 'dark:text-gray-400');
                    }
                }

                applySavedSettings() {
                    const savedTab = localStorage.getItem('activeTab');
                    if (savedTab) {
                        if (savedTab === 'web-reflect') {
                            const savedLang = localStorage.getItem('preferredLang');
                            this.setLanguage(savedLang || ((navigator.language || navigator.userLanguage).startsWith('zh') ? 'zh' : 'en'));
                        } else {
                            this.loadModule(savedTab);
                        }
                    } else {
                        this.setLanguage((navigator.language || navigator.userLanguage).startsWith('zh') ? 'zh' : 'en');
                    }
                }
            }

            const viewer = new PromptViewer();
        </script>
    </body>

</html>
